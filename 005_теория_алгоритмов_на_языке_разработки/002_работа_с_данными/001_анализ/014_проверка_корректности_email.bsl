
// Проверка корректности e-mail
// Автор: Гордеев Никита, 2024

Функция ПроверитьEmail(АдресЭлектроннойПочты)

    Если ПустаяСтрока(АдресЭлектроннойПочты) Тогда
        Возврат Ложь;
    КонецЕсли;

    // Преобразуем адрес в нижний регистр
    АдресЭлектроннойПочты = СтрЗаменить(АдресЭлектроннойПочты, "", "");
    АдресЭлектроннойПочты = НРег(АдресЭлектроннойПочты);

    // Валидные символы для разных частей e-mail
    ВалидныеСимволыИмя = "abcdefghijklmnopqrstuvwxyz0123456789.%+_-";
    ВалидныеСимволыДомен = "abcdefghijklmnopqrstuvwxyz0123456789.-";
    ВалидныеСимволыTLD = "abcdefghijklmnopqrstuvwxyz";

    // Флаги и счетчики
    НайденСимволСобака = Ложь;
    НайденТочкаПослеСобака = Ложь;
    КоличествоДоСобака = 0;
    КоличествоПослеСобака = 0;
    КоличествоПослеТочки = 0;

    Для Индекс = 1 По СтрДлина(АдресЭлектроннойПочты) Цикл
        ТекущийСимвол = Сред(АдресЭлектроннойПочты, Индекс, 1);

        // Обнаружили первый символ @
        Если НЕ НайденСимволСобака И НЕ НайденТочкаПослеСобака И ТекущийСимвол = "@" Тогда
            НайденСимволСобака = Истина;
            Продолжить;
        КонецЕсли;

        // Обнаружили . после @
        Если НайденСимволСобака И НЕ НайденТочкаПослеСобака И ТекущийСимвол = "." Тогда
            НайденТочкаПослеСобака = Истина;
            Продолжить;
        КонецЕсли;

        // Подсчет символов до @
        Если НЕ НайденСимволСобака И НЕ НайденТочкаПослеСобака Тогда
            КоличествоДоСобака = КоличествоДоСобака + 1;
        КонецЕсли;

        // Подсчет символов после @, но до точки
        Если НайденСимволСобака И НЕ НайденТочкаПослеСобака Тогда
            КоличествоПослеСобака = КоличествоПослеСобака + 1;
        КонецЕсли;

        // Подсчет символов после точки
        Если НайденСимволСобака И НайденТочкаПослеСобака Тогда
            КоличествоПослеТочки = КоличествоПослеТочки + 1;
        КонецЕсли;

        // Проверка допустимых символов до @
        Если НЕ НайденСимволСобака И НЕ НайденТочкаПослеСобака Тогда
            Если СтрНайти(ВалидныеСимволыИмя, ТекущийСимвол) = 0 Тогда
                Возврат Ложь;
            КонецЕсли;
        КонецЕсли;

        // Проверка допустимых символов после @ и до точки
        Если НайденСимволСобака И НЕ НайденТочкаПослеСобака Тогда
            Если СтрНайти(ВалидныеСимволыДомен, ТекущийСимвол) = 0 Тогда
                Возврат Ложь;
            КонецЕсли;
        КонецЕсли;

        // Проверка допустимых символов после точки
        Если НайденСимволСобака И НайденТочкаПослеСобака Тогда
            Если СтрНайти(ВалидныеСимволыTLD, ТекущийСимвол) = 0 Тогда
                Возврат Ложь;
            КонецЕсли;
        КонецЕсли;
    КонецЦикла;

    // Финальная проверка
    Если НайденСимволСобака 
       И НайденТочкаПослеСобака 
       И КоличествоДоСобака >= 1 
       И КоличествоПослеСобака >= 1 
       И КоличествоПослеТочки >= 2 
       И КоличествоПослеТочки <= 6 Тогда
        Возврат Истина;
    Иначе
        Возврат Ложь;
    КонецЕсли;

КонецФункции



Процедура ПриНачалеРаботыСистемы()
    Почта = "nikitagordeev@10yandex.ru"; 
    
    // Функция 
    РезультатПроверки = ПроверитьEmail(Почта);
    Сообщить("Адрес Email валиден: " + Строка(РезультатПроверки));

КонецПроцедуры
